# 10亿数据找到第7亿大的数

## 简介

和“10亿数据找到中位数”是同类型问题。

## 快速排序

### 1. 思路

* step1：以数组最后一个元素作为基准值，将数据partition为`[left,mid-1]`和`[mid,right]`两个区间，其中`[left,mid-1]`的数都小于base值，`[mid,right]`都大于等于base值
* step2：计算`[mid, right]`数组长度L：
  * 如果L等于三亿，那么`[left,mid-1]`中的七亿个数字小于`[mid,right]`中的三亿个数字，只需要在`[left,mid-1]`中找到最大值即可
  * 如果L大于三亿，则将问题转化为在`[mid, right]`中找到第（L-三亿）个数
  * 如果L小于三亿则问题还是在`[left,mid-1]`中找到第七亿大的数

> 在step2中，如果数据量级足够小则可以直接进行排序得到答案。

### 2. 优点

相比于后面提到的桶排序而言，不需要限制数据范围有限，也不需要假定数据是比较均匀分布的。

### 3. 时间复杂度

加入每次partition都能将数据均匀分成两部分，那第一次partition的时间复杂度为$$O(n)$$，第二次partition的时间复杂度为$$O(\frac{n}{2})$$，以此类推，最终的时间复杂度趋近于$$O(2n)$$。

## 桶排序

### 1. 思路

假如数据的范围是有限的（有最大值和最小值）且较均匀分布，那么使用桶排序可以进一步提升效率：

* step1：获取数据的max和min
* step2：将所有的n份数据分到m个文件中，同时记录每份子文件中的数据量
* step3：从小到大累加文件数据量，找到第七亿个数所在的文件，记录前面文件的总数据量count
* step4：将问题转化为在第七亿个数所在的文件中寻找第（七亿-count）个数

> 在step4中，如果内存足够存放所有数据，可以直接排序获取第七亿个数字。

### 2. 特点

桶排序在数据有上下限且分布比较均匀时效果最佳，假设数据极值（最大值-最小值）较大且数据基本分布在固定区间时会导致第一轮分桶时数据都集中在一个桶中，受限于内存大小我们需要进一步提高桶的数量。

### 3. 时间复杂度

假设数据分布比较均匀且我们每轮分k个桶，那么第一轮分桶的时间复杂度为$$O(n)$$，第二轮只需要在某一个桶中继续分桶，时间复杂度为$$O(\frac{n}{k})$$，以此类推，总的时间复杂度为：
$$
O(n) + O(\frac{n}{k}) + O(\frac{n}{k^2}) + ... \approx O(\frac{k}{k-1}\times n)
$$
由此可见，当桶的数量大于等于3时，桶排序的渐进复杂度要优于快速排序。
