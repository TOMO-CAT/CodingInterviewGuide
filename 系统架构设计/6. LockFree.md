# LockFree

LockFree编程指的是在编程中尽量少使用锁结构，降低线程间相互阻塞的机会以提高程序的性能，但LockFree并没有规定代码的具体编写方法。

如果程序中的某一部分满足如下三个条件，就可以称这部分程序是LockFree的：

* 多线程
* 共享内存
* 不能彼此阻塞（死锁）

![img](image/231017024496623.png)

在 LockFree 程序中，如果一个线程被挂起，决不能影响其他线程继续执行，即非阻塞的（Non-Blocking）。

## 不使用锁带来的问题

通过 LockFree 的定义，我们知道如果使用锁（比如 mutex），那么其实现必然不是 LockFree 的。因为使用 mutex 时，如果其中一个线程持有锁并被挂起，那么其他线程都会阻塞在获取锁。

如果不能使用锁，那么将会带来很多其他的问题。这是因为诸如 mutex 之类的锁都不仅仅是在逻辑中创建一个独占区，**还会根据实际运行的系统创建内存屏障、阻止指令重排、建立内存的一致性模型**。当我们不再使用锁时就必须更加小心地去注意这些事情。

## 内存模型

TODO。
