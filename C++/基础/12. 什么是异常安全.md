# 什么是异常安全

## 问题

* 什么是异常安全？
* 异常安全有哪几种类型？

## 解析

> Effective C++：Strive for exception-safe code.
>
> * 异常安全函数（Exception-safe function）即使发生异常也不会泄露资源或允许任何数据结构败坏。这样的函数区分为三种可能的保证：基本型、强烈型和不抛出异常型。
> * “强烈保证”往往能够以 copy-and-swap 实现出来，但“强烈保证”并非对所有函数都可实现或具备现实意义。
> * 函数提供的“异常安全保证”通常最高只等于其所调用之各个函数的“异常安全保证”中的最弱者。

“异常安全”由两个条件，当异常被抛出时，带有异常安全性的函数满足：

* 不泄露任何资源
* 不允许数据败坏

异常安全函数（Exception-safe function）提供以下三种保证之一：

* **基本承诺**：如果异常被抛出，程序内的任何事物仍然保持在有效状态下。没有任何对象或数据结构会因此而败坏，所有对象都处于一种内部前后一致的状态。**抛出异常时对象可以保持缺省状态也可以保持调用前状态，客户端可以调用某个成员函数获得具体的状态**。
* **强烈保证**：如果异常被抛出，程序状态不改变。调用这样的函数需要有这样的认知：如果函数成功就是完全成功；如果函数失败程序会回复到“调用函数之前”的状态。（与此对比的是，如果调用一个只提供“基本承诺”的函数而真的出现异常，程序有可能处于任何状态——只要它是个合法状态）
* **不抛出异常（nothrow）保证**：承诺绝不抛出异常，因为它们总是能够完成它们原先承诺的功能。作用于内置类型（例如 int、指针等等）身上的所有操作都提供 nothrow 保证。
